# This file is part of Flask-AppFactory
# Copyright (C) 2015 CERN.
#
# Flask-AppFactory is free software; you can redistribute it and/or modify it under
# the terms of the Revised BSD License; see LICENSE file for more details.

web:
  build: ../
  dockerfile: examples/Dockerfile
  command: myapp run -h 0.0.0.0
  environment:
    - "BROKER_URL=redis://redis:6379/0"
    - "CELERY_RESULT_BACKEND=redis://redis:6379/1"
    - "MYAPP_APP_CONFIG_ENVS=BROKER_URL,CELERY_RESULT_BACKEND"
  volumes:
   - ..:/code
  links:
    - redis
  ports:
    - "127.0.0.1:5000:5000"
worker:
  build: ../
  dockerfile: examples/Dockerfile
  command: celery worker -A myapp.celery --loglevel=INFO --purge
  environment:
    - "BROKER_URL=redis://redis:6379/0"
    - "CELERY_RESULT_BACKEND=redis://redis:6379/1"
    - "MYAPP_APP_CONFIG_ENVS=BROKER_URL,CELERY_RESULT_BACKEND"
  volumes_from:
    - web
  read_only: true
  links:
    - redis
redis:
  image: redis
  expose:
    - "6379"
  read_only: true
